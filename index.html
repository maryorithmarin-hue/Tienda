<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TIENDA STORE Noem칤</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <div class="header">
    <h1>TIENDA STORE Noem칤</h1>
    <p>游깵 Juigalpa, Nicaragua</p>
    <p>Frente al nuevo estadio</p>
  </div>

  <div class="container">
    <!-- Productos se cargan autom치ticamente desde Google Sheets -->
  </div>

  <!-- MODAL -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close">X</span>
      <img id="modal-img" src="" alt="Producto">
      <div id="modal-price" class="modal-price"></div>
      <a id="whatsapp-btn" class="whatsapp-btn" href="" target="_blank">Comprar por WhatsApp</a>
      <div id="soldout" class="soldout" style="display:none;">
        <div class="soldout-text">AGOTADO</div>
        <a class="btn" id="request-btn" href="" target="_blank">Solicitar m치s</a>
      </div>
    </div>
  </div>

  <script>
    // Tu ID de la hoja
    const sheetId = "1l3IuIq2WPCMI-72WcfwIX-7DDLGqYUWfSTEA2V6q7vA";

    // Enlace para leer JSON
    const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;

    fetch(sheetUrl)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substring(47).slice(0, -2));
        const rows = json.table.rows;

        const products = rows.map(r => ({
          id: r.c[0] ? r.c[0].v : "",
          product: r.c[1] ? r.c[1].v : "",
          category: r.c[2] ? r.c[2].v : "",
          price: r.c[3] ? r.c[3].v : "",
          quantity: r.c[4] ? r.c[4].v : "",
          photo: r.c[5] ? r.c[5].v : "",
          status: r.c[6] ? r.c[6].v : ""
        }));

        displayProducts(products);
      });

    function displayProducts(products) {
      const container = document.querySelector(".container");
      container.innerHTML = "";

      products.forEach(p => {
        const available = p.quantity > 0 && p.status.toLowerCase() === "disponible";

        container.innerHTML += `
          <div class="card">
            <img class="product-img" src="${p.photo}" alt="${p.product}">
            <h3>${p.product}</h3>
            <div class="price">${p.price} d칩lares</div>
            <button class="open-modal" 
              data-img="${p.photo}" 
              data-price="${p.price} d칩lares" 
              data-status="${available ? "available" : "soldout"}"
              data-product="${p.product}"
            >Ver</button>
          </div>
        `;
      });

      // Evento para abrir modal
      document.querySelectorAll(".open-modal").forEach(btn => {
        btn.addEventListener("click", () => {
          const img = btn.getAttribute("data-img");
          const price = btn.getAttribute("data-price");
          const status = btn.getAttribute("data-status");
          const product = btn.getAttribute("data-product");

          document.getElementById("modal-img").src = img;
          document.getElementById("modal-price").innerText = price;

          if (status === "available") {
            document.getElementById("whatsapp-btn").style.display = "block";
            document.getElementById("soldout").style.display = "none";
            document.getElementById("whatsapp-btn").href = "https://wa.me/50584908088?text=Hola%20quiero%20comprar%20este%20producto:%20" + encodeURIComponent(product);
          } else {
            document.getElementById("whatsapp-btn").style.display = "none";
            document.getElementById("soldout").style.display = "block";
            document.getElementById("request-btn").href = "https://wa.me/50584908088?text=Hola%20quiero%20solicitar%20este%20producto:%20" + encodeURIComponent(product);
          }

          document.getElementById("modal").style.display = "block";
        });
      });

      // Cerrar modal
      document.querySelector(".close").addEventListener("click", () => {
        document.getElementById("modal").style.display = "none";
      });
    }
  </script>

</body>
</html>
